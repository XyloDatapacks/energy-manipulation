# summon UI
$summon minecraft:area_effect_cloud ~ ~ ~ {Tags:["smithed.entity","smithed.strict","xem.spell.display","xem.spell.display_new"],Duration:100000000,
Passengers:[\
    {id:"minecraft:text_display",Rotation:[$(rotation_x)f,$(rotation_y)f],Tags:["smithed.entity","smithed.strict","xem.spell.display","xem.spell.display.0"],view_range:0.1,brightness:{block:15,sky:15},billboard:"fixed",transformation:{left_rotation:{angle:3.141590,axis:[0.0f,1.0f,0.0f]},right_rotation:[0.0f,0.0f,0.0f,1.0f],scale:[0.03f,0.03f,0.03f],translation:[0.0f,-0.01f,0.15f]},default_background:0b,background:0,text:'["",{"storage":"energy_manipulation:op","nbt":"spell_display[$(0)].concatenate_index"},"\\n",{"translate":"energy_manipulation.spell.key.$(k0)","fallback":"$(k0)","color":"white"},"\\n","\\n",{"translate":"energy_manipulation.spell.value.$(v0)","fallback":"$(v0)","color":"white"}]',\
        Passengers:[\
            {id:"minecraft:text_display",Rotation:[$(rotation_x)f,$(rotation_y)f],Tags:["smithed.entity","smithed.strict","xem.spell.display","xem.spell.display.0"],view_range:0.1,brightness:{block:15,sky:15},billboard:"fixed",transformation:{left_rotation:{angle:3.141590,axis:[0.0f,1.0f,0.0f]},right_rotation:[0.0f,0.0f,0.0f,1.0f],scale:[0.035f,0.035f,0.035f],translation:[0.0f,0.0f,0.18f]},default_background:0b,background:0,text:'["",{"translate":"energy_manipulation.spell.back_ground.$(k0)","fallback":"\\uE000","font":"energy_manipulation:spell/keys","color":"$(c0)"}]'},\
            {id:"minecraft:text_display",Rotation:[$(rotation_x)f,$(rotation_y)f],Tags:["smithed.entity","smithed.strict","xem.spell.display","xem.spell.display.i0"],view_range:0.1,brightness:{block:15,sky:15},billboard:"fixed",transformation:{left_rotation:{angle:3.141590,axis:[0.0f,1.0f,0.0f]},right_rotation:[0.0f,0.0f,0.0f,1.0f],scale:[0.025f,0.025f,0.025f],translation:[0.0f,-0.05f,0.175f]},default_background:0b,background:0,text:'["",{"text":"\\uE000","font":"energy_manipulation:icons/generic"},{"translate":"energy_manipulation.spell.display.far_left_1","fallback":"far_left_1","color":"white"},"\\n",{"text":"\\uE001","font":"energy_manipulation:icons/generic"},{"translate":"energy_manipulation.spell.display.far_left_2","fallback":"far_left_2","color":"white"}]'},\
            {id:"minecraft:text_display",Tags:["smithed.entity","smithed.strict","xem.spell.display","xem.spell.display.ibg0"],view_range:0.1,brightness:{block:15,sky:15},billboard:"fixed",transformation:{left_rotation:{angle:3.141590,axis:[0.0f,1.0f,0.0f]},right_rotation:[0.0f,0.0f,0.0f,1.0f],scale:[0.025f,0.025f,0.025f],translation:[0.0f,-0.045f,0.178f]},default_background:0b,background:0,text:'["",{"translate":"energy_manipulation.spell.back_ground.generic","fallback":"\\uE000","font":"energy_manipulation:spell/keys","color":"$(i_color)"}]'}\
        ]\
    },\
    {id:"minecraft:text_display",Rotation:[$(rotation_x)f,$(rotation_y)f],Tags:["smithed.entity","smithed.strict","xem.spell.display","xem.spell.display.1"],view_range:0.1,brightness:{block:15,sky:15},billboard:"fixed",transformation:{left_rotation:{angle:3.141590,axis:[0.0f,1.0f,0.0f]},right_rotation:[0.0f,0.0f,0.0f,1.0f],scale:[0.03f,0.03f,0.03f],translation:[0.0f,-0.01f,0.15f]},default_background:0b,background:0,text:'["",{"storage":"energy_manipulation:op","nbt":"spell_display[$(1)].concatenate_index"},"\\n",{"translate":"energy_manipulation.spell.key.$(k1)","fallback":"$(k1)","color":"white"},"\\n","\\n",{"translate":"energy_manipulation.spell.value.$(v1)","fallback":"$(v1)","color":"white"}]',\
        Passengers:[\
            {id:"minecraft:text_display",Rotation:[$(rotation_x)f,$(rotation_y)f],Tags:["smithed.entity","smithed.strict","xem.spell.display","xem.spell.display.1"],view_range:0.1,brightness:{block:15,sky:15},billboard:"fixed",transformation:{left_rotation:{angle:3.141590,axis:[0.0f,1.0f,0.0f]},right_rotation:[0.0f,0.0f,0.0f,1.0f],scale:[0.035f,0.035f,0.035f],translation:[0.0f,0.0f,0.18f]},default_background:0b,background:0,text:'["",{"translate":"energy_manipulation.spell.back_ground.$(k1)","fallback":"\\uE000","font":"energy_manipulation:spell/keys","color":"$(c1)"}]'},\
            {id:"minecraft:text_display",Rotation:[$(rotation_x)f,$(rotation_y)f],Tags:["smithed.entity","smithed.strict","xem.spell.display","xem.spell.display.i1"],view_range:0.1,brightness:{block:15,sky:15},billboard:"fixed",transformation:{left_rotation:{angle:3.141590,axis:[0.0f,1.0f,0.0f]},right_rotation:[0.0f,0.0f,0.0f,1.0f],scale:[0.025f,0.025f,0.025f],translation:[0.0f,-0.05f,0.175f]},default_background:0b,background:0,text:'["",{"text":"\\uE000","font":"energy_manipulation:icons/generic"},{"translate":"energy_manipulation.spell.display.left_1","fallback":"left_1","color":"white"},"\\n",{"text":"\\uE001","font":"energy_manipulation:icons/generic"},{"translate":"energy_manipulation.spell.display.left_2","fallback":"left_2","color":"white"}]'},\
            {id:"minecraft:text_display",Tags:["smithed.entity","smithed.strict","xem.spell.display","xem.spell.display.ibg1"],view_range:0.1,brightness:{block:15,sky:15},billboard:"fixed",transformation:{left_rotation:{angle:3.141590,axis:[0.0f,1.0f,0.0f]},right_rotation:[0.0f,0.0f,0.0f,1.0f],scale:[0.025f,0.025f,0.025f],translation:[0.0f,-0.045f,0.178f]},default_background:0b,background:0,text:'["",{"translate":"energy_manipulation.spell.back_ground.generic","fallback":"\\uE000","font":"energy_manipulation:spell/keys","color":"$(i_color)"}]'}\
        ]\
    },\
    {id:"minecraft:text_display",Rotation:[$(rotation_x)f,$(rotation_y)f],Tags:["smithed.entity","smithed.strict","xem.spell.display","xem.spell.display.2"],view_range:0.1,brightness:{block:15,sky:15},billboard:"fixed",transformation:{left_rotation:{angle:3.141590,axis:[0.0f,1.0f,0.0f]},right_rotation:[0.0f,0.0f,0.0f,1.0f],scale:[0.03f,0.03f,0.03f],translation:[0.0f,-0.01f,0.15f]},default_background:0b,background:0,text:'["",{"storage":"energy_manipulation:op","nbt":"spell_display[$(2)].concatenate_index"},"\\n",{"translate":"energy_manipulation.spell.key.$(k2)","fallback":"$(k2)","color":"#00CFFF","bold":"true"},"\\n","\\n",{"translate":"energy_manipulation.spell.value.$(v2)","fallback":"$(v2)","color":"#00CFFF","bold":"true"}]',\
        Passengers:[\
            {id:"minecraft:text_display",Rotation:[$(rotation_x)f,$(rotation_y)f],Tags:["smithed.entity","smithed.strict","xem.spell.display","xem.spell.display.2"],view_range:0.1,brightness:{block:15,sky:15},billboard:"fixed",transformation:{left_rotation:{angle:3.141590,axis:[0.0f,1.0f,0.0f]},right_rotation:[0.0f,0.0f,0.0f,1.0f],scale:[0.035f,0.035f,0.035f],translation:[0.0f,0.0f,0.18f]},default_background:0b,background:0,text:'["",{"translate":"energy_manipulation.spell.back_ground.$(k2)","fallback":"\\uE000","font":"energy_manipulation:spell/keys","color":"$(c2)"}]'},\
            {id:"minecraft:text_display",Rotation:[$(rotation_x)f,$(rotation_y)f],Tags:["smithed.entity","smithed.strict","xem.spell.display","xem.spell.display.i2"],view_range:0.1,brightness:{block:15,sky:15},billboard:"fixed",transformation:{left_rotation:{angle:3.141590,axis:[0.0f,1.0f,0.0f]},right_rotation:[0.0f,0.0f,0.0f,1.0f],scale:[0.025f,0.025f,0.025f],translation:[0.0f,-0.05f,0.175f]},default_background:0b,background:0,text:'["",{"text":"\\uE000","font":"energy_manipulation:icons/generic"},{"translate":"energy_manipulation.spell.display.$(i_center_1)","fallback":"center_1","color":"white"},"\\n",{"text":"\\uE001","font":"energy_manipulation:icons/generic"},{"translate":"energy_manipulation.spell.display.center_2","fallback":"center_2","color":"white"}]'},\
            {id:"minecraft:text_display",Tags:["smithed.entity","smithed.strict","xem.spell.display","xem.spell.display.ibg2"],view_range:0.1,brightness:{block:15,sky:15},billboard:"fixed",transformation:{left_rotation:{angle:3.141590,axis:[0.0f,1.0f,0.0f]},right_rotation:[0.0f,0.0f,0.0f,1.0f],scale:[0.025f,0.025f,0.025f],translation:[0.0f,-0.045f,0.178f]},default_background:0b,background:0,text:'["",{"translate":"energy_manipulation.spell.back_ground.generic","fallback":"\\uE000","font":"energy_manipulation:spell/keys","color":"$(i_color)"}]'}\
        ]\
    },\
    {id:"minecraft:text_display",Rotation:[$(rotation_x)f,$(rotation_y)f],Tags:["smithed.entity","smithed.strict","xem.spell.display","xem.spell.display.3"],view_range:0.1,brightness:{block:15,sky:15},billboard:"fixed",transformation:{left_rotation:{angle:3.141590,axis:[0.0f,1.0f,0.0f]},right_rotation:[0.0f,0.0f,0.0f,1.0f],scale:[0.03f,0.03f,0.03f],translation:[0.0f,-0.01f,0.15f]},default_background:0b,background:0,text:'["",{"storage":"energy_manipulation:op","nbt":"spell_display[$(3)].concatenate_index"},"\\n",{"translate":"energy_manipulation.spell.key.$(k3)","fallback":"$(k3)","color":"white"},"\\n","\\n",{"translate":"energy_manipulation.spell.value.$(v3)","fallback":"$(v3)","color":"white"}]',\
        Passengers:[\
            {id:"minecraft:text_display",Rotation:[$(rotation_x)f,$(rotation_y)f],Tags:["smithed.entity","smithed.strict","xem.spell.display","xem.spell.display.3"],view_range:0.1,brightness:{block:15,sky:15},billboard:"fixed",transformation:{left_rotation:{angle:3.141590,axis:[0.0f,1.0f,0.0f]},right_rotation:[0.0f,0.0f,0.0f,1.0f],scale:[0.035f,0.035f,0.035f],translation:[0.0f,0.0f,0.18f]},default_background:0b,background:0,text:'["",{"translate":"energy_manipulation.spell.back_ground.$(k3)","fallback":"\\uE000","font":"energy_manipulation:spell/keys","color":"$(c3)"}]'},\
            {id:"minecraft:text_display",Rotation:[$(rotation_x)f,$(rotation_y)f],Tags:["smithed.entity","smithed.strict","xem.spell.display","xem.spell.display.i3"],view_range:0.1,brightness:{block:15,sky:15},billboard:"fixed",transformation:{left_rotation:{angle:3.141590,axis:[0.0f,1.0f,0.0f]},right_rotation:[0.0f,0.0f,0.0f,1.0f],scale:[0.025f,0.025f,0.025f],translation:[0.0f,-0.05f,0.175f]},default_background:0b,background:0,text:'["",{"text":"\\uE000","font":"energy_manipulation:icons/generic"},{"translate":"energy_manipulation.spell.display.right_1","fallback":"right_1","color":"white"},"\\n",{"text":"\\uE001","font":"energy_manipulation:icons/generic"},{"translate":"energy_manipulation.spell.display.right_2","fallback":"right_2","color":"white"}]'},\
            {id:"minecraft:text_display",Tags:["smithed.entity","smithed.strict","xem.spell.display","xem.spell.display.ibg3"],view_range:0.1,brightness:{block:15,sky:15},billboard:"fixed",transformation:{left_rotation:{angle:3.141590,axis:[0.0f,1.0f,0.0f]},right_rotation:[0.0f,0.0f,0.0f,1.0f],scale:[0.025f,0.025f,0.025f],translation:[0.0f,-0.045f,0.178f]},default_background:0b,background:0,text:'["",{"translate":"energy_manipulation.spell.back_ground.generic","fallback":"\\uE000","font":"energy_manipulation:spell/keys","color":"$(i_color)"}]'}\
        ]\
    },\
    {id:"minecraft:text_display",Rotation:[$(rotation_x)f,$(rotation_y)f],Tags:["smithed.entity","smithed.strict","xem.spell.display","xem.spell.display.4"],view_range:0.1,brightness:{block:15,sky:15},billboard:"fixed",transformation:{left_rotation:{angle:3.141590,axis:[0.0f,1.0f,0.0f]},right_rotation:[0.0f,0.0f,0.0f,1.0f],scale:[0.03f,0.03f,0.03f],translation:[0.0f,-0.01f,0.15f]},default_background:0b,background:0,text:'["",{"storage":"energy_manipulation:op","nbt":"spell_display[$(4)].concatenate_index"},"\\n",{"translate":"energy_manipulation.spell.key.$(k4)","fallback":"$(k4)","color":"white"},"\\n","\\n",{"translate":"energy_manipulation.spell.value.$(v4)","fallback":"$(v4)","color":"white"}]',\
        Passengers:[\
            {id:"minecraft:text_display",Rotation:[$(rotation_x)f,$(rotation_y)f],Tags:["smithed.entity","smithed.strict","xem.spell.display","xem.spell.display.4"],view_range:0.1,brightness:{block:15,sky:15},billboard:"fixed",transformation:{left_rotation:{angle:3.141590,axis:[0.0f,1.0f,0.0f]},right_rotation:[0.0f,0.0f,0.0f,1.0f],scale:[0.035f,0.035f,0.035f],translation:[0.0f,0.0f,0.18f]},default_background:0b,background:0,text:'["",{"translate":"energy_manipulation.spell.back_ground.$(k4)","fallback":"\\uE000","font":"energy_manipulation:spell/keys","color":"$(c4)"}]'},\
            {id:"minecraft:text_display",Rotation:[$(rotation_x)f,$(rotation_y)f],Tags:["smithed.entity","smithed.strict","xem.spell.display","xem.spell.display.i4"],view_range:0.1,brightness:{block:15,sky:15},billboard:"fixed",transformation:{left_rotation:{angle:3.141590,axis:[0.0f,1.0f,0.0f]},right_rotation:[0.0f,0.0f,0.0f,1.0f],scale:[0.025f,0.025f,0.025f],translation:[0.0f,-0.05f,0.175f]},default_background:0b,background:0,text:'["",{"text":"\\uE000","font":"energy_manipulation:icons/generic"},{"translate":"energy_manipulation.spell.display.far_right_1","fallback":"far_right_1","color":"white"},"\\n",{"text":"\\uE001","font":"energy_manipulation:icons/generic"},{"translate":"energy_manipulation.spell.display.far_right_2","fallback":"far_right_2","color":"white"}]'},\
            {id:"minecraft:text_display",Tags:["smithed.entity","smithed.strict","xem.spell.display","xem.spell.display.ibg4"],view_range:0.1,brightness:{block:15,sky:15},billboard:"fixed",transformation:{left_rotation:{angle:3.141590,axis:[0.0f,1.0f,0.0f]},right_rotation:[0.0f,0.0f,0.0f,1.0f],scale:[0.025f,0.025f,0.025f],translation:[0.0f,-0.045f,0.178f]},default_background:0b,background:0,text:'["",{"translate":"energy_manipulation.spell.back_ground.generic","fallback":"\\uE000","font":"energy_manipulation:spell/keys","color":"$(i_color)"}]'}\
        ]\
    },\
    {id:"minecraft:interaction",Tags:["smithed.entity","smithed.strict","xem.spell.display"],width:0.1,height:0.1,response:1},\
    {id:"minecraft:text_display",Rotation:[$(rotation_x)f,$(rotation_y)f],Tags:["smithed.entity","smithed.strict","xem.spell.display","xem.spell.display.info"],view_range:1.0,brightness:{block:15,sky:15},billboard:"fixed",transformation:{left_rotation:{angle:3.141590,axis:[0.0f,1.0f,0.0f]},right_rotation:[0.0f,0.0f,0.0f,1.0f],scale:[0.025f,0.025f,0.025f],translation:[0.0f,0.043f,0.15f]},default_background:0b,background:0,line_width:140,text:'["",{"translate":"energy_manipulation.spell.display.info.key.$(info)","fallback":"","color":"white"}]',Passengers:[{id:"minecraft:text_display",Rotation:[$(rotation_x)f,$(rotation_y)f],Tags:["smithed.entity","smithed.strict","xem.spell.display","xem.spell.display.info"],view_range:1.0,brightness:{block:15,sky:15},billboard:"fixed",transformation:{left_rotation:{angle:3.141590,axis:[0.0f,1.0f,0.0f]},right_rotation:[0.0f,0.0f,0.0f,1.0f],scale:[0.085f,0.085f,0.085f],translation:[0.0f,0.07f,0.18f]},default_background:0b,background:0,text:'["",{"text":"\\uE006","font":"energy_manipulation:spell/keys","color":"$(c2)"}]'}]},\
    {id:"minecraft:item_display",Rotation:[0.0f,90.0f],Tags:["smithed.entity","smithed.strict","xem.spell.display"],item:{id:"minecraft:paper",Count:1b,tag:{CustomModelData:$(circle_cmd)}},view_range:1.0,brightness:{block:15,sky:15},billboard:"vertical",transformation:{left_rotation:[0.0f,0.0f,0.0f,1.0f],right_rotation:[0.0f,0.0f,0.0f,1.0f],scale:[2.5f,2.5f,0.1f],translation:[0.0f,0.0f,$(circle_offset)f]}}\
]}\

# set "@s xem.spell.display.node_index_input" from center node value_index
$execute store result score #xem.spell.display.node_index_input xem.op run data get storage energy_manipulation:op spell_display[$(2)].value_index

# set UI data
execute store result score #xem.spell.display.summon_angle xem.op run data get entity @s Rotation[1]
execute if score #xem.spell.display.summon_angle xem.op matches ..-30 rotated ~ -30 as @e[type=area_effect_cloud,distance=..0.01,tag=xem.spell.display_new,limit=1] run function energy_manipulation:spell/display/summon_data
execute if score #xem.spell.display.summon_angle xem.op matches -29..29 as @e[type=area_effect_cloud,distance=..0.01,tag=xem.spell.display_new,limit=1] run function energy_manipulation:spell/display/summon_data
execute if score #xem.spell.display.summon_angle xem.op matches 30.. rotated ~ 30 as @e[type=area_effect_cloud,distance=..0.01,tag=xem.spell.display_new,limit=1] run function energy_manipulation:spell/display/summon_data

# give player tag
scoreboard players set @s xem.spell.display.has_display 1


